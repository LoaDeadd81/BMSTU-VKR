\chapter{Конструкторский раздел}

\section{Модель многофункциональных центров\\обслуживания}

Многофункциональный центр обслуживания состоит комбинации 3 простейших элементов: генератор, очередь и обслуживающий аппарат, из которых собираются ресепшен и окна обслуживания, а их них весь центр. Генератор представляет из себя переход, без входных дуг. Переходы, имеющие ненулевое время срабатывания изображены в виде сплошного чёрного прямоугольника. Моментальные переходы изображены в виде прямоугольника с белой заливкой.


\subsection{Модель обслуживающего аппарата}

На рисунке~\ref{img:AO} представлена модель обслуживающего аппарата.

\imgScale{1.5}{AO}{Модель обслуживающего аппарата}
\FloatBarrier

Описание позиций:
\begin{itemize}[label=---]
	\item $p_1$ --- ожидание входа в аппарат;
	\item $p_2$ --- нахождение в аппарате, обслуживание заявки;
	\item $p_3$ --- выход из аппарата после обслуживания.
\end{itemize}

Переход $t_1$ осуществляет вход в аппарат и активируется, если в $p_1$ есть хоть одна фишка, а в $p_2$ не одной, то есть, если есть заявка ожидающая обслуживания и никто не обслуживается, то переход сработает. Проверка отсутствия фишки в $p_2$ реализована с помощью ингибиторной дуги. В результате срабатывания этого перехода из $p_1$ в $p_2$ переносится 1 фишка. Переход $t_2$ ,срабатывает с задержкой равной времени обслуживания, осуществляет ожидание обработки и выход заявки из аппарата.

\subsection{Модель очереди}

На рисунке~\ref{img:queue} представлена модель очереди.

\imgScale{1.5}{queue}{Модель очереди}
\FloatBarrier

Описание позиций:
\begin{itemize}[label=---]
	\item $p_1$ --- ожидание входа в очередь;
	\item $p_2$ --- нахождение в очереди;
	\item $p_3$ --- выход из очереди;
	\item $p_4$ --- ограничитель размера очереди, где $Q$ --- количество фишек, максимальный размер очереди, который при входе в $p_2$ уменьшается, а при выходе увеличивается.
\end{itemize}

Описание переходов:
\begin{itemize}[label=---]
	\item $t_1$ --- вход в очередь, сработает если в $p_1$ и $p_4$ есть фишки, то есть счётчик оставшейся ёмкость очереди больше нуля;
	\item $t_2$ --- выход из очереди, сработает если $p_2$ есть фишки, то есть кто-то есть в очереди, и увеличивает счётчик оставшейся ёмкость очереди;
	\item $t_3$ --- выход из системы, если очередь слишком большая, сработает если не сработал $t_1$ и нет нет не одной фишки в $p_4$.
\end{itemize}

\subsection{Модель ресепшен}

На рисунке~\ref{img:reception} представлена модель ресепшен.

\imgScale{1.5}{reception}{Модель ресепшен}
\FloatBarrier

Модель ресепшен является объединением очереди и обслуживающего аппарата. Модели объединяются через переход $t_2$, переход отвечает за выход из очереди и обновление её счётчика и за вход в обслуживающий аппарата. Если есть заявка ожидающая в очереди и никто не обслуживается в аппарате, то переход срабатывает. В позиции $p_2$ лежат фишки отвечающие за нахождение в очереди, а в $p_3$ фишка отвечающая за занятие обслуживающего аппарата.

\subsection{Модель окон обслуживания}

На рисунке~\ref{img:windows} представлена модель окон обслуживания.

\imgScale{1.5}{windows}{Модель окон обслуживания}
\FloatBarrier

Модель окон является объединением очереди и нескольких обслуживающих аппаратов аппарата. Модели объединяются через переходы $t_{11}$ и $t_{21}$, аналогично ресепшен. Оба перехода забирают заявки из очереди, помещают их в обслуживающий аппарат и обновляют счётчик очереди. Также время срабатывания переходов $t_{i2}$ зависит от значения цвета фишки.

\subsection{Модель многофункционального центра обслуживания}

На рисунке~\ref{img:mfc} представлена модель многофункционального центра обслуживания.

\imgScale{0.65}{mfc}{Модель многофункционального центра обслуживания}
\FloatBarrier

Модель многофункционального центра обслуживания является объединением моделей ресепшена и окон. Соединяются они через переходы $t_{s1}$ и $t_{s2}$. В модели используется цветная сеть Петри. В этом примере определён один целочисленный тип (цвет), который описывает тип фишки, каждому типу соответствует своё число. Так как только один цвет, то и все позиции и дуги одного <<типа>>. Также определена свободная переменная $x$ целочисленного типа, используемая в вращениях для переходов. Все переходы, кроме $t_{ci}$, пропускают фишку с любым значением типа, девствуют как обычные переходы. А переходы $t_{ci}$ срабатывают только при наличии фишки определённого типа или типов, в связной с ними позиции. Таким образом реализуется разграничение различных видов услуг по времени обработки и окнам. Переходы $t_{ent_i}$ является генераторами фишек различного типа, а переходы $t_{exit_i}$ удаляют фишки, вышедшие из системы. 

\section{Моделирующий алгоритм}

В алгоритме имеется два параметра: $M$, количество списков, и $mlt$, шаг списков. В работе алгоритм использует часовую структуру, которая представляет собой несколько иерархических списков, при этом в списке  $i + 1$ уровня в $mlt$ раз больше ячеек чем в $i$-м списке. Каждая ячейка списка отвечает за определённый промежуток времени. Каждая ячейка $i$-го списка соответствует $mlt$ ячейкам списка уровнем ниже. Во всем списках кроме самого нижнего, где ячейка списка соответствует элементарному шагу в системе, лежит количество событий, которое должно произойти в соответствующий промежуток времени. Ячейки нижнего списка содержат указатели непосредственно на списки событий. Алгоритм последовательно перебирает ячейки пока не находит ненулевою, спускается на уровень ниже и продолжает поиск ненулевых ячеек. Спустившись до нулевого уровня, выполняет события и возвращается вверх по спискам для продолжения поиска событий. Это позволяет алгоритму проматывать большие пустые интервалы времени, как событийный метод, и в тоже время при наличии событий работать как метод с постоянным шагом. Схема алгоритма изображена на рисунках~\ref{img:delft1}--~\ref{img:delft5}.

\imgScale{0.8}{delft1}{Схема функции обработки верхнего списка}
\FloatBarrier

\imgScale{0.7}{delft2}{Схема функции обработки промежуточных списков}
\FloatBarrier

\imgScale{1}{delft3}{Схема функции обработки нижнего списка}
\FloatBarrier

\imgScale{0.9}{delft4}{Схема функции обработки ячейки нижнего списка}
\FloatBarrier

\imgScale{0.9}{delft5}{Схема функции вставки события}
\FloatBarrier

\section*{Вывод}

В данном разделе были представлены модели примитивов, из которых строятся модели элементов многофункциональных центров. Также были описаны как сами элементы центров обслуживания, так и полностью собранная модель  многофункциональных центров обслуживания. Были приведены схемы алгоритмов функционирования сетей Петри и моделирующего алгоритма. 