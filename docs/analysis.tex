\chapter{Аналитический раздел}

\section{Анализ предметной области}

\subsection{Основные понятия}

При моделировании важно использовать модель, адекватную исследуемой системе. Это означает, что существенные с точки зрения разработчика свойства модели и системы в достаточной для анализа степени должны совпадать. В исследованиях используют модели, а не реальные системы по следующим причинам: реальные системы очень сложны, поэтому для их анализа применяются упрощённые модели, или проведение эксперимента просто невозможно, из--за каких--либо физических ограничений. Определения основных понятий~\cite{m_types}:
\begin{itemize}[label=---]
	\item система --- совокупность объектов, взаимодействующих друг с другом, которая может является частью другой системы и включать в себя системы;
	\item модель --- объект, созданный для получения новых знаний о объекте--оригинале, отражающий только существенные свойства оригинала;
	\item моделирование --- исследование каких--либо явлений, систем или процессов путём построения и анализа модели.
\end{itemize}

На рисунке~\ref{img:m_types} представленная классификация основных видов моделирования~\cite{m_types}.
\imgScale{0.9}{m_types}{Виды моделирования}
\FloatBarrier

При \textbf{физическом} моделировании используется сама система или подобная ей. Физическая модель может быть реализована в уменьшенном или увеличенном масштабе~\cite{m_types}.

Под \textbf{математическим} моделированием понимается процесс установления соответствия реальной системе математической модели и исследование этой модели, позволяющее получить характеристики реальной системы. Применение математического моделирования позволяет исследовать объекты, реальные эксперименты над которыми затруднены или невозможны. В зависимости от вида модели математическое моделирование делится на аналитическое и компьютерное. Заметим, что аналитическое решение предпочтительнее, но его не всегда удаётся получить~\cite{m_types}.

При \textbf{компьютерном} моделировании модель формулируется в виде алгоритма или программы. Можно разделить на численное, статистическое и имитационное~\cite{m_types}.

При \textbf{численном} моделировании используются методы вычислительной математики~\cite{m_types}.

При \textbf{статистическом} моделировании выполняется обработка данных о системе с целью получения статистических характеристик системы~\cite{m_types}.

При \textbf{имитационном} моделировании процесс функционирования исследуемой системы воспроизводится на ЭВМ при соблюдении логической и временной последовательности протекания процессов, что позволяет узнать данные о состоянии системы или отдельных ее элементов в определённые моменты времени~\cite{m_types}.

\subsection[Моделирование многофункциональных центров\\обслуживания]{Моделирование многофункциональных центров обслуживания}

Многофункциональные центры обслуживания (МФЦ) --- это современные организации, призванные обеспечивать широкий спектр административных и государственных услуг гражданам и юридическим лицам в одном месте. В последние годы подобные центры получили широкое распространение в многих странах, в том числе и в России, где они известны как <<Мои документы>>. Являются структурированной системой, предназначенной для предоставления различных видов услуг клиентам. Они могут включать в себя комплексные процессы, включающие как прямое обслуживание клиентов, так и внутренние операционные процессы.

Для эффективного управления многофункциональными центрами обслуживания необходимо иметь понимание их работы и оптимальные стратегии управления. Моделирование является мощным инструментом, который позволяет анализировать и прогнозировать процессы обслуживания, а также оптимизировать их эффективность.

Услуги в центре могут оказываться как непосредственно представители организаций--участников, так и универсальными специалистами, являющимися работниками центра. Помимо этого все услуги, оказываемые на площадке МФЦ, можно разделить на три типа~\cite{serv_types}:
\begin{itemize}[label=---]
	\item консультации (результатом таких услуг является информация, за которой прошёл заявитель);
	\item приём документов (при получении таких услуг заявить приносит и отдаёт некий набор документов);
	\item выдача документов (как правило за такими услугами обращаются после первых двух, при их получении заявителю передаётся некоторый набор бумаг).
\end{itemize}

Разные типы услуг стоит рассматривать по разному в процессе моделирования.

В результате моделирования центра можно получить множество различных параметров его работы, на основе которых делать выводы об текущей эффективности и предлагать улучшения, которые также можно будет промоделировать. Такой итеративный процесс позволит создать экономичную и эффективную систему обслуживания клиентов. Выделяются следующие характеристики, имеющие практические ценность, центра, которые можно получить в результате моделирования~\cite{har1},~\cite{har2}:
\begin{itemize}[label=---]
	\item среднее время обслуживания;
	\item среднее время пребывания клиентов в очереди;
	\item вероятность простоя специалиста;
	\item вероятность попадания клиента в очередь;
	\item вероятность ухода клиента.
\end{itemize}

Исходя из этих и других характеристик можно оценить общую эффективность работы, экономическую и социальную эффективность и т.~д. Все характеристики измеряются отдельно для разных типов специалистов и очередей. 

\section[Классификация методов моделирования\\многофункциональных центров обслуживания]{Классификация методов моделирования\\многофункциональных центров\\обслуживания}

Рассмотрим наиболее общие и часто используемые методы, применяемые для моделирования многофункциональных центров обслуживания.

\subsection{Конечные автоматы}

Автомат можно представить как некоторое устройство (чёрный ящик), на которое подаются входные сигналы, снимаются выходные сигналы и которое может иметь определённые внутренние состояния. Они являются дискретно--детерминированными моделями (F--схема)~\cite{ak_det}.

Введём понятие алфавит, понимая под ним конечное множество объектов любой природы. В этом случае сами объекты можно называть буквами, ах конечную упорядоченную совокупность называют словом~\cite{ak_det}.

Конечный автомат имеет один вход и один выход. Он представляет собой объект, функционирующий в дискретные моменты времени. В каждый момент времени $t_i$ автомат находится в одном из возможных состояний $z(t_i)$. Начиная с нулевого момента времени на вход автомата поступает входной сигнал $х$, который является одной из букв входного алфавита $Х$.
Автомат следующим образом реагирует на поступление входных сигналов. Во--первых, состояние автомата изменяется в соответствии с одношаговой функцией переходов:
\begin{equation}
	\label{eq:ka_tr}
	z(t_i) = \varphi(z(t_{i-1}), x(t_i)).
\end{equation}
Во--вторых в каждый момент на выходе автомата появляется выходной сигнал $y(t_i)$, который является буквой выходного алфавита $Y$, и определяется функцией выходов:
\begin{equation}
	\label{eq:ka1_q}
	y(t_i) = \psi(z(t_{i-1}), x(t_i)).
\end{equation}

Таким образом конечный автомат можно определить как кортеж $A = (X, Y, Z, z_0, \varphi, \psi)$, где $X=\{x_1, ..., x_m\}$ --- множество входных сигналов (входной алфавит),  $Y=\{y_1, ..., y_n\}$ --- множество выходных сигналов (выходной алфавит), $Z=\{z_1, ..., z_f\}$ --- множество состояний (внутренний алфавит), $z_0$ --- начальное состояние, $\varphi$ --- функция переходов, которая некоторым парам <<состояние -- входной сигнал>> ставит в соответствие  новое состояние автомата, $\psi$ --- функция выходов, которая некоторым парам <<состояние -- входной сигнал>> ставит в соответствие выходные сигналы автомата. В общем случае конечный автомат может иметь много входов, состояний и выходов. В этом случае алфавиты представляют собой прямые произведения более простых алфавитов~\cite{ak_det}.

Смысл работы автомата состоит в том, что он реализует некоторое отображение множества слов входного алфавита $Х$ во множество слов выходного алфавита $Ү$. На уровне абстрактной теории понятие <<работа автомата>> понимается как преобразование входных слов в выходные~\cite{ak_det}. 

На практике наибольшее распространение получили автоматы Мили и Мура. Автомат Мили функционирует по формулам (\ref{eq:ka_tr}) и (\ref{eq:ka1_q}), то есть состояние и выходной сигнал зависят от входного сигнала и предыдущего состояния. У автомата Мура функция переходов  совпадает с формулой (\ref{eq:ka_tr}), но функция выходов имеет вид $y(t_i) = \psi(z(t_{i-1}))$, то есть не зависит от входного сигнала. Автомат Мили --- более общий автомат, чем автомат Мура. У каждого конечного автомата Мура есть конечный автомат Мили его интерпретирующий~\cite{ak_types}.

В табличном виде автомат Мили задаётся двумя таблицами. Первая таблица описывает функцию перехода, в ней столбцы это состояния, а строки входные символы, а на пересечении находятся новые состояния. Вторая таблица аналогичным образом описывает функцию выходов. Для автомата Мура первая таблица такая же, а вторая состоит только из двух строк состоянии и выходов~\cite{ak_types}.

При решении задач моделирования часто более удобной формой является матричное задание конечного автомата. При этом можно рассматривать две матрицы --- матрицу переходов и матрицу выходов. Матрица переходов есть квадратная матрица, строки которой соответствуют исходным состояниям, а столбцы - состояниям перехода. Элементы на пересечении соответствует входному сигналу, вызывающему переход. Матрица выходов строится аналогично, но ее элемент соответствует выходному сигналу, выдаваемому при переходе. При матричном задании конечного автомата Мура матрица переходов аналогична соответствующей матрице автомата Мили, а выход описывается вектором выходов~\cite{ak_types}.

Ещё есть графический способ, при котором автомат представляется в виде направленного графа. Вершинами являются состояния, если из одного состояния можно перейти в другое, то они соединяются направленной дугой и ей присваивается метка. Эта метка содержит входной и выходной символ перехода~\cite{ak_types}. Граф автомата Мили изображён на рисунке \ref{img:miligr}.

\imgScale{0.8}{mili}{Граф автомата Мили}
\FloatBarrier

Граф автомата Мура задаётся аналогично, только метка пути не содержит выходного символа. Он привязан к вершине~\cite{ak_types}. Граф автомата Мура изображён на рисунке \ref{img:murgr}.

\imgScale{0.8}{mur}{Граф автомата Мили}
\FloatBarrier

По характеру отсчёта времени конечные автоматы делятся на синхронные и асинхронные. Автомат считается синхронным, когда моменты поступления входных сигналов, изменения состояний и выдачи выходных сигналов, определяются принудительно синхронизирующими сигналами (заранее определены). Реакция автомата на каждое значение входного сигнала заканчивается за один такт синхронизации. Асинхронные автоматы не имеют «жесткой» тактности. Они изменяют свои состояния при поступлении входных сигналов, которые могут появляться в произвольные моменты времени из некоторого интервала~\cite{ak_det}.

Конечные автоматы работают с дискретным временем и позволяют моделировать только детерминированные объекты. Также они имеют, только одно состояние на всю систему и не способны отражать параллельные процессы. 

\subsection{Вероятностные автоматы}

Дискретно--стохастический подход (P--схемы) использует в качестве математического аппарата вероятностные автоматы, которые можно определить, как дискретные потактные преобразователи информации с памятью, функционирование которых в каждом такте зависит только от состояния памяти в них и может быть описано статистически. Для такого автомата характерно задание таблицы вероятностей перехода автомата в некоторое состояние и появления некоторого выходного сигнала в зависимости от текущего состояния и входного сигнала~\cite{sheme_types}.

Конечный автомат рассматривался как детерминированный, то есть каждой паре состояния и входа однозначно сопоставлялись новое состояние и выход с помощью функций переходов и выходов. Вероятностный конечный автомат --- такой автомат, который вместо однозначного соответствия задаёт лишь условные вероятности появления некоторых пар <<новое состояние -- выход>>, при условии реализаций некой пары <<состояние -- вход>>~\cite{va}.

Кроме того, для вероятностного конечного автомата не задаётся однозначно начальное состояние, а задаётся лишь безусловные вероятности, с которыми каждое из состояний может оказаться начальным. Эти вероятности должны быть в промежутке от 0 до 1 и в сумме давать 1~\cite{va}. 

Описание функционирования вероятностного конечного автомата можно трактовать так, что для каждой пары <<состояние -- вход>> задаётся совместное условное распределение вероятностей осуществления пар <<состояние -- выход>>. Сумма этих вероятностей должна быть равна единице для каждой пары <<состояние -- вход>>~\cite{va}.

Если считать вероятности нового состояния и выхода независимо друг от друга, то этот автомат называется вероятностным автоматом Мили. Также подобно конечному автомату Мура возможен вероятностный конечный автомат, у которого выход не зависит от входа, а зависит только от текущего состояния~\cite{va}.

Вероятностный конечный автомат называется автономным, если все случайные законы распределения одинаковы при различных вариантах сочетания входных алфавитов~\cite{va}.

Вероятностные автоматы работают аналогично конечным автоматам, но позволяют моделировать стохастические системы.

\subsection{Системы массового обслуживания}

Непрерывно--стохастический подход (Q--схема) применяется для формализации процессов обслуживания.  Этот подход наиболее известен ввиду того, что большинство производственных, экономических, технических и т.д. систем по сути являются системами массового обслуживания. Под системой массового обслуживания понимают динамическую систему, предназначенную для эффективного обслуживания потока заявок  при ограничениях на доступные ресурсы. В любой системе массового обслуживания можно выделить элементарный прибор, в котором уже выделяют накопитель заявок некоторой ёмкости, ожидающих обслуживания, канал обслуживания и потоки событий. Существует поток заявок на обслуживание, характеризующийся моментами времени поступления и их атрибутами, и поток обслуживания, характеризующийся моментами начала и окончания обслуживания заявок. Под непрерывностью тут обозначается непрерывность времени. Моменты поступления заявки в систему и окончания обслуживания заявки --- случайны~\cite{sheme_types}. Структура системы массового обслуживания приведена на рисунке \ref{img:smo}.

\imgScale{1}{smo}{Стрктурная схема СМО}
\FloatBarrier

Основными задачами решаемые в рамках теории массового обслуживания являются: анализ, то есть определение количественных характеристик СМО при заданной структуре и параметрах элементов, и синтез оптимальной структуры при заданных характеристиках и ограничениях на параметры элементов~\cite{ak_det}.

На вход СМО поступают заявки на обслуживание, образующие входящий поток. Они поступают из источником заявок. В зависимости от характера источника заявок различают разомкнутые и замкнутые СМО. В разомкнутых число заявок, вырабатываемых источником, считается неограниченным и поведение источника никак не связано с состоянием системы в любой момент времени. Для замкнутых СМО характерно конечное количество заявок, циркулирующих в системе. Обслуженные заявки возвращаются в источник и через некоторый момент времени могут попасть опять на вход~\cite{ak_det}.

По характеру обслуживания заявок все системы массового обслуживания делятся на три типа:
\begin{itemize}[label=---]
	\item системы с отказами;
	\item системы с ожиданием;
	\item системы смешанного типа.
\end{itemize}
СМО первого типа характеризуются тем, что поступившие в данный момент времени заявка тут же принимается к обслуживанию, если имеется хотя бы один свободный канал, или получает отказ, если все каналы заняты. В системах с ожиданием заявка в случае занятости всех каналов обслуживания становится в очередь и ожидает освобождения одного из них. Это наиболее представительный на практике класс систем. Системам смешанного типа присущи особенности двух вышеописанных систем. Заявка в такой системе становится в очередь, если в ожидании находится ограниченное число заявок. Этим числом может быть длинна очереди. Ограничение также может быть и по длительности ожидания~\cite{smo}.

По дисциплине обслуживания заявок выделяют системы без приоритета и с приоритетом~\cite{smo}.

Ещё одним из признаков классификации является количество обслуживающих устройств или каналов: если система имеет один прибор или один канал, то она называется одноканальной, если же их более одного, то она называется многоканальной~\cite{smo_chan}. 

Важнейшей характеристикой СМО является входящий поток заявок. Число заявок в единицу времени, обычно называется интенсивностью и обознается $\lambda$. Если входящий поток является простейшим, поток распределён по закону Пуасона, то достаточно знать лишь $\lambda$ (или интервал поступление заявок $t_i = \frac{1}{\lambda}$). А интервал входящего на обслуживание потока $v_\lambda = 1$. В общем случает надо знать средннее значение $\lambda$ и $t_i$ и дисперсионную характеристику интервала входящего на обслуживание потока $v_\lambda$~\cite{smo}.

Система характеризуется числом каналов обслуживания $n$, длительностью обслуживания $t_p$ одной заявки и пропускной способностью $\mu$, число заявок, которое может обслужить поток в единицу времени. Отношение $\rho = \frac{\lambda}{\mu} = \frac{t_p}{t_i}$ называется коэффициентом использования пропускной способности или приведённой плотностью потока~\cite{smo}. 

При работе система имеет одно состояние, которое меняется в зависимости от количества занятых каналов.

Многофункциональный центр обслуживания можно смоделировать используя, разомкнутую многоканальную СМО смешанного типа без приоритетов. Тогда рассмотрим $n$--канальную СМО с ожиданием, на которую поступает поток заявок с интенсивностью $\lambda$. Интенсивность обслуживания одного канала $m$. Число мест в очереди $m$. Тогда основные показатели работы СМО приведены ниже~\cite{smo}.

Вероятность того, что система находится в состоянии, в котором все каналы свободны обознается как $p_0$ и вычисляется по формуле
\begin{equation}
	\label{eq:smo_po}
	p_0 = (\sum_{i=0}^{n}\frac{\rho^i}{i!} + \frac{\rho^n+1(1-(\frac{\rho}{n})^m)}{n \cdot n! (1 - \frac{\rho}{n})})^{-1}.
\end{equation}
Среднее число заявок в очереди обознается как $L_q$ и вычисляется по формуле
\begin{equation}
	\label{eq:smo_lq}
	L_q=\frac{\rho^{n+1} p_0\left(1-\left(m+1-m \frac{\rho}{n}\right)\left(\frac{\rho}{n}\right)^m\right)}{n \cdot n !\left(1-\frac{\rho}{n}\right)^2}.
\end{equation}
Среднее число заявок под обслуживанием или средннее число занятых каналов обознается как $\bar{k}$ и вычисляется по формуле
\begin{equation}
	\label{eq:smo_k}
	\bar{k}=\rho\left(1-\frac{\rho^{n+m}}{n^m \cdot n !} p_0\right).
\end{equation}
Среднее число заявок в системе обознается как $L_s$ и вычисляется по формуле
\begin{equation}
	\label{eq:smo_ls}
	L_s=L_q+\bar{k}.
\end{equation}
Относительная пропускная способность обознается как $Q$ и вычисляется по формуле
\begin{equation}
	\label{eq:smo_q}
	Q=1-\frac{\rho^{n+m}}{n^m n !} p_0.
\end{equation}
Абсолютная пропускная способность системы обознается как $A$ и вычисляется по формуле
\begin{equation}
	\label{eq:smo_a}
	A=\lambda Q.
\end{equation}

Под системой массового обслуживания понимают динамическую систему, предназначенную для эффективного обслуживания потока заявок  при ограничениях на ресурсы системы. Она является непрерывно--стохастической моделью, где непрерывность подразумевает непрерывность времени. Позволяет моделировать случайные процессы. К данной модели сводится множество систем реального мира. Данный метод позволяет моделировать стохастические и параллельные системы, но имеет только одно состояние на всю систему, отображающее количество занятых потоков.

\subsection{Сети Петри}
Сетевой подход (N--схема) используется для формализованного описания и анализа причинно--следственных связей в сложных системах, где одновременно протекает несколько процессов. Самым распространенным формализмом, описывающим структуру и взаимодействие параллельных систем и процессов, являются сети Петри~\cite{sheme_types}.

Сеть Петри --- это математическая модель дискретных динамических систем, ориентированная на качественный анализ и синтез таких систем. Формально в терминах теории систем сеть Петри это кортеж
\begin{equation}
	\label{eq:smo_a}
	PN = (O,P,T,F,M_0),
\end{equation} где:
\begin{itemize}[label=---]
	\item $O=\{0,1,2,\ldots\}$ --- множество дискретных моментов времени;
	\item $P=\{p_1,p_2,\ldots\}$ --- непустое множество элементов сети, называемых позициями;
	\item $T=\{t_1,t_2,\ldots\}$ --- непустое множество элементов сети, называемых переходами;
	\item $F:(P \times T) \cup(T \times P) \rightarrow\{0,1,2, \ldots, k, \ldots\}$ --- функция инцидентности, где $k$ --- кратность дуги;
	\item $M_0$ --- начальная маркировка позиций.
\end{itemize}
Множества позиций и переходов не пересекаются~\cite{petri}.

Функция инцидентности может быть представлена в виде $F = F^p \cup F^t$ и фактически задаёт два отображения: $F^p(p,t) = P \times T \rightarrow\{0,1,2, \ldots\}$, т.е. для каждой позиции указываются связанные с ней переходы (с учётом их кратности); $F^t(t, p) = T \times P \rightarrow\{0,1,2, \ldots\}$, т.е. для каждого перехода указываются связанные с ним позиции (также с учётом кратности)~\cite{petri}. 

Эти функции, в общем случае зависящие от времени, могут быть представлены матрицами инцидентности. Из вершины--позиции $p_i \in P$ дуга в вершину--переход $t_j \in T$ существует тогда и только тогда, когда элемент на пересечении $i$--ой строки и $j$--го столбца в матрице $f_{ij}^p > 0$. В этом случае говорят, что $t_i$ выходной переход позиции $p_i$. Аналогичным образом определяется выходная позиция перехода~\cite{petri}.

Каждая позиция $p_i \in P$ может содержать некоторый целочисленный ресурс $\mu(p) \ge 0$, называемый числом фишек внутри позиции. Вектор $M = [\mu_1, \mu_2, \ldots]$ называется маркировкой (разметкой) сети Петри. Каждая маркировка --- это отображение $M: P \rightarrow \{0,1,2,\ldots\}$~\cite{petri}. 

Сети Петри функционирует в дискретном времени и концентрируют внимание на локальных событиях (переходах), локальных условиях (позициях) и локальных связях~\cite{petri}.

Смена маркировок (начиная с $M_0$) происходит в результате срабатывания переходов сети. Переход сети $t_j \in T$ может сработать при маркировке $M$, если для всех входных позиций $p_i \in P$ выполняется условие $\mu(p_i) - f_{ij}^p \ge 0$, т.е. если каждая входная позиция для данного перехода содержит столько же и ли больше фишек чем кратность ведущей к переходу дуги. В результате срабатывания перехода в момент времени $\theta$ происходит смена маркировки по правилу: $\mu_i(\theta + 1) = \mu_i(\theta) - f_{ij}^p(\theta) -  f_{ji}^t(\theta)$. То есть переход изымает из каждой своей входной позиции число фишек, равное кратности входных дуг, и посылает в каждую свою выходную позицию число фишек, равное кратности выходных дуг. Если может сработать несколько переходов, то срабатывает один, любой из них. Функционирование сети останавливается, если при некоторой маркировке ни один из ее переходов не может сработать. В силу своей недетерминированности при одинаковой начальной разметки сети Петри могут порождать различные последовательности срабатывания ее переходов. Эти последовательности образуют слова в алфавите Т. Множество всевозможных слов, порождаемых сетью Петри, называют языком сети Петри. Две сети Петри эквивалентны, если порождают один и тот же язык~\cite{petri}. 

Сети Петри также представимы в виде двудольного ориентированного мультиграфа. Этот граф содержит:
\begin{itemize}[label=---]
	\item позиции (места), обозначаемые кружками;
	\item переходы, обозначаемые планками;
	\item ориентированные дуги (стрелки), соединяющие позиции с переходами и переходы с позициями.
\end{itemize}
Благодаря наличию кратных дуг сеть Петри есть мультиграф. Благодаря двум типам вершин граф называется двудольным. Поскольку дуги имеют направление, граф является ориентированным~\cite{petri}. Пример такого графа изображён на рисунке \ref{img:petri}.

\imgScale{1.5}{petri}{Граф сети Петри}
\FloatBarrier

\subsubsection{Свойства сетей Петри}

Исходя из практических задач моделирования, можно установить ряд свойств сетей Петри, характеризующих поведение моделируемых систем~\cite{petri}.

\textbf{Свойство ограниченности}. Позиция $p_i$ в сети называется ограниченной если для любой достижимой в сети маркировки $M$ существует такое $k$, что $\mu_i \le k$. Сеть называется ограниченной, если все ее позиции ограничены.

\textbf{Свойство безопасности}. Сеть называется безопасной, если при любой достижимой маркировке для любого $\mu_i \le 1$. Таким образом, в безопасной сети вектор маркировок состоит только из нулей и единиц.

\textbf{Свойство консервативности}. Сеть называется консервативной, если сумма фишек во всех позициях остаётся постоянной при работе сети.

\textbf{Свойство живости}. Переход $t_i$ называется потенциально живым, если существует достижимая из $M_0$ маркировка $M^\prime$, при которой $t_i$ может сработать. Если $t_i$ является потенциально живым при любой достижимой маркировке, то он называется живым. Переход $t_i$, не являющийся потенциально живым при $M_0$ называется мёртвым при этой маркировке. Маркировка $M_0$ в этом случае называется тупиковой для $t_i$. Переход называется устойчивым, если никакой другой переход не может лишить его возможности сработать при наличии для этого необходимых условий, то есть нет конфликта.

\subsubsection{Модификации сетей Петри}

Базовое определение сети Петри позволяют моделировать широкий класс дискретных систем. Однако в ряде случаев этих возможностей оказывается недостаточно, поэтому вводят обобщения этих сетей, которые обладают расширенными возможностями моделирования~\cite{petri}.

\textbf{Ингибиторные сети} --- это сети Петри, для которых функция инцидентности имеет вид $F = F^p \cup F^t \cup F^i$, т.е. она дополнена специальной функцией инцидентности $F^i(t, p) = T \times P \rightarrow\{0,1\}$, которая вводит ингибиторные дуги. Правила срабатывания переходов в ингибиторной сети модифицируются следующим образом. Переход $t_i$ срабатывает, если для всех связанных с ним позиций $p_i$ и $p_k$ выполняется $(\mu(p_i) \ge f_{ij}^p) \wedge (\mu(p_k) \cdot f^i_{kj} = 0)$, где  $p_k$ позиция связанная с переходом ингибиторной дугой. То есть позиции связанные через ингибиторные дуги не должны содержать фишек.

\textbf{Сети с приоритетами} --- это сети Петри, в которой каждому переходу приписан приоритет. В стандартной сети Петри в случае, когда могут сработать несколько переходов, срабатывает любой из них. При моделировании реальных систем могут сложиться ситуации, когда последовательность срабатываний необходимо регламентировать. Это можно сделать, введя множество приоритетов $PR: T \rightarrow\{0,1,\dots\}$ и приписав каждому из переходов $t_j$ соответствующее целочисленное значение приоритета $pr_js$ . Тогда правило срабатывания переходов модифицируется: если на некотором такте работы сети PN имеется возможность для срабатывания нескольких переходов, то срабатывает тот из них, который имеет наивысший приоритет.

\textbf{Сети со случайными срабатываниями переходов} -- это сети Петри, в которой каждому переходу $t_i$ приписана вероятность срабатывания $p_i$, при этом $\sum_{i=0}^{n} p_i = 1$, где $n$ --- количество переходов. То есть в случае, когда могут сработать несколько переходов, они срабатывают с учётом своих вероятностей и для каждой группы таких переходов сумма их вероятностей должна равняться единице. Отождествив маркировки с состоянием сети и положив, что вероятности не зависят от работы сети в предыдущие такты, мы получим цепь Маркова, описывающие вероятностное поведение системы.

\textbf{Иерархические сети Петри} представляют собой многоуровневые структуры, в которых выделяются сети различного уровня. Они позволяют моделировать различные многоуровневые (иерархические) системы. В отличие от обыкновенных сетей Петри, в иерархических сетях имеются два типа переходов: простые и составные. Составные переходы содержат внутри себя сеть Петри более низкого уровня. Формально они состоят из входного и выходного переходов, между ними находится некоторая сеть Петри, которая, в свою очередь, также может быть иерархической. Срабатывание составных переходов является не мгновенным событием, а составным действием. На каждом шаге дискретного времени составной переход может находиться в одном из двух состояний - пассивном и активном. Составной переход может быть активирован , если он до этого был пассивен и имеются условия для срабатывания его головного перехода. При этом производится изменение маркировки в сети верхнего уровня по обычным правилам и запускается работа в сети, находящейся внутри составного перехода. Сеть нижнего уровня работает с учётом своей начальной маркировки до тез пор, пока все ее переходы не станут пассивными, т.е. не смогут сработать. После этого происходит срабатывание хвостового перехода и изменение маркировки сети верхнего уровня. Составной переход возвращается в пассивное состояние, а в сети нижнего уровня восстанавливается начальная маркировка.

\textbf{Временные сети Петри} называют пару $(PN, f)$, где $PN$ --- ординарная сеть Петри, а $f$ – функция задержки переходов $t$, $f : T \rightarrow N^+$, где $N^+$ --- множество целых неотрицательных чисел. Таким образом, каждому переходу $t_i$ сети Петри приписывается некоторое число $\tau_i = f(t_i)$, смысл которого состоит в следующем. После момента времени, когда переход оказался возбуждённым, он срабатывает ровно через $\tau_i$  единиц времени. Если при данной маркировке несколько переходов конфликтуют, то срабатывает тот из них, задержка которого минимальна. Если при данной маркировке возбуждены два или более перехода с одинаковой задержкой, то они сработают одновременно~\cite{timed_petri}.

\textbf{Стохастические сети Петри} --- отличается от ординарной сети тем, что в ней каждый переход помечается либо средней скоростью его срабатывания (время срабатывания возбуждённого перехода --- случайная величина), либо вероятностью его срабатывания при возбуждении, в то время как в ординарной сети рассматривается лишь возможность срабатывания возбуждённого перехода. Формально стохастическая сеть Петри представляет собой расширение ординарной СП, за счёт введения дополнительного отображения $\lambda : T \rightarrow N^+$, где $N^+$ --- множество целых неотрицательных чисел. Иначе говоря, каждому переходу $t_i \in T$ отображение $\lambda$ ставит в соответствие некоторое число $\lambda_i$, интерпретируемое как средняя скорость срабатывания этого перехода. Эта характеристика носит вероятностный характер. Обычно полагают, что скорость срабатывания перехода имеет показательное распределение. Имеет место теорема о том, что любая конечная cтохастические сети Петри изоморфна одномерной дискретной марковской цепи~\cite{timed_petri}.

\textbf{Цветные сети Петри (CPN)}. Для СРN не существует чёткого определения. СРN являются всего лишь некоторым абстрактным термином, обозначающим сети Петри с расширенными возможностями, как минимум, в отношении типизации элементов сетей. Наиболее распространённой и общей является версия разработанная Куртом Иенсеном (университет Орхуса)~\cite{cpnNoForm}. 

Типы в CPN называются наборами цветов и включают целый, логический, интервалы целых, конечные перечисления, а также структурные типы --- кортежи, записи и списки ограниченной или неограниченной длины. Для перехода к цветной сети Петри, надо задать совокупность типов данных (наборов цветов) $\Sigma$ и функцию цветности $C :P \rightarrow \Sigma$, которая каждому месту $p$ приписывает некоторый тип $C(p)$. Тип места указывает тип значений, которые может содержать фишка, находящийся в этом месте. А какие именно фишки и в каком количестве находятся в каждом месте задаёт разметка. То есть, разметка $M$ это функция, которая с каждым местом связывает мультимножество $M(p) \in C(p)_{MS}$ . Далее, каждой дуге $a \in A$ задаётся выражение $E(a)$ типа $C(p)_{MS}$ , где $p$ — место, связанное с дугой $a$. Для каждого перехода $t$ определяется выражение $G(t)$ логического типа -- охрана (по умолчанию -- истина)~\cite{cpn}.

Все выражения могут содержать в качестве свободных переменных только переменные из заранее заданного списка переменных $V$ , причём для каждой переменной $v \in V$ должен быть зафиксирован ее тип $Type(v) \in \Sigma$. Если задано связывание $b : V  \rightarrow \cup \Sigma$ всех переменных $v \in V$ со значениями $b(v)$ нужного типа $Type(v)$, то всякое выражение $G(t)$ или $E(a)$ может быть вычислено до значения логического типа или $C(p)_{MS}$, соответственно. Для результата вычисления будем использовать обозначение $E(a) \langle b \rangle$, соответственно $G(t) \langle b \rangle$. При этом связывание $b$ должно содержать как минимум все (свободные) переменные данного выражения. В качестве начальной разметки $M_0$ для каждого места $p$ задаётся замкнутое (не содержащее свободных переменных) выражение $I(p)$, которое вычисляется до некоторого конечного мультимножества типа $C(p)_{MS}$ . Таким образом, цветная сеть Петри задаётся как набор из десяти компонентов: $CPN = (P, T, A, N, \Sigma, V, C, E, G, I)$~\cite{cpn}.

Внешний токен --- это пара $(p, v)$, где $v \in C(p)$. Множество всех возможных внешних токенов данной CPN обозначим $TE$. Внешнее связывание это пара $(t, b)$, где $t \in T$ и $b \in B(t)$. Множество всех внешних связываний перехода $t$ определим как $BE(t) = {(b, t)|b \in B(t)}$. Множество всех внешних связываний данной CPN обозначим $BE$. Шаг $Y \in BE_{MS}$ это непустое конечное мультимножество внешних
связываний. Определим $A(p, t)$ как множество всех дуг из $p$ в $t$. $A(p, t) = {a|N(a) = (p, t)}$. Аналогично $A(t, p)$. Определим $E(p, t)$ как формальную сумму всех выражений на дугах из $A(p, t)$. Это допустимо, поскольку типы значение всех этих выражений одинаковые. Если нет дуг из $p$ в $t$, то $E(p, t) = \varnothing$. Аналогично $E(t, p)$~\cite{cpn}.

Связывание $(t, b)$ допускается разметкой $M_1$, если для всякого места $p$ выполняется $E(p, t) \langle b \rangle  \leq M_1(p)$. Тогда переход $t$ (со связыванием $b$) может сработать, породив новую разметку $M2 = M_1 - \Sigma_ {p \in P} E(p, t) \langle b \rangle + \Sigma_{p \in P} E(t, p)\langle b \rangle$. Иначе говоря, значения выражений $E(p, t) \langle b \rangle$ на входных дугах показывают мультимножества токенов, которые необходимы для срабатывания перехода $t$ со связыванием $b$ и которые при этом срабатывании будут из разметки удалены, а взамен будет добавлено мультимножество токенов, заданное выражением $E(t, p) \langle b \rangle$~\cite{cpn}.

Шаг $Y$ допускается разметкой $M_1$, если для всякого места $p$ справедливо $\Sigma_{(t,b) \in Y} E(p, t) \leq M_1(p)$, где суммирование производится с учётом кратностей элементов $Y$. Тогда могут сработать одновременно все элементы шага $Y$, порождая новую разметку $M_2$, такую что для всякого места $p$ выполняется $M_2(p) = M_1(p) - \Sigma_{(t,b) \in Y} E(p, t) + \Sigma_{(t,b) \in Y} E(t, p)$. И тогда говорят, что разметка $M_2$ непосредственно достижима из разметки $M_1$. Конечная или бесконечная последовательность шагов, а также отношение достижимости определяются и обозначаются так же, как и для стандартных сетей Петри~\cite{cpn}.

\subsubsection{Вывод}

Сеть Петри --- это математическая модель дискретных динамических систем, ориентированная на моделирование параллельных систем. Имеет множество обобщений, расширяющих её функционал. Позволяет моделировать стохастические системы. Сконцентрирована на локальных событиях в системе, что позволяет отображать состояние  всей системы и ей отдельных элементов. Позволят выделять некоторые части в отдельные функциональные блоки с помощью иерархических сетей. Также стохастические сети Петри позволяют учитывать, не только время, но и его вероятностные параметры, что особенно важно для моделирования МФЦ. Цветные сети Петри позволяют разграничить заявки по типам, а также собирать статистику отдельно по каждой заявке, а не только по элементам системы.

\subsection[Сравнение методов моделирования\\многофункциональных центров обслуживания]{Сравнение методов моделирования\\многофункциональных центров\\обслуживания}

Для рассмотренных методов выделим следующие критерии сравнения:
\begin{itemize}[label=---]
	\item возможность моделирования стохастических систем (К1);
	\item возможность моделирования параллельных систем (К2);
	\item тип состояния (К3) --- некоторые методы имеют только одно глобальное состояние на всю системы, другие концентрируются на локальных событиях, условиях и связях, что позволяет получить более подробную информацию о состоянии всей системы и её отдельных элементов;
	\item учёт времени (К4) --- возможность учёта времени при моделировании;
	\item учёт времени (К5) --- возможность учёта различных типов заявок в системе.
\end{itemize}

Результаты сравнение приведённых методов по выделенным критериям представлены в таблице \ref{tbl:cmp}.

\begin{table}[!ht]
	\begin{center}
		\begin{threeparttable}
			\captionsetup{justification=raggedright,singlelinecheck=off}
			\caption{Результаты сравнения  методов}
			\label{tbl:cmp}
			\begin{tabular}{|l|c|c|c|c|}
				\hline
				\makecell[c]{Критерий} & КА & ВА & СМО & СП \\\hline
				К1	& Нет & Да &	Да & Да \\\hline
				К2 & Нет & Нет & Да & Да \\\hline
				К3 & Глобальное & Глобальное & Глобальное &	Локальное \\\hline
				К4 & Нет & Нет & Да & Да \\\hline
				К5 & Нет & Нет & Нет & Да \\\hline
			\end{tabular}
		\end{threeparttable}
	\end{center}
\end{table}

Исходя из результатов сравнение можно сделать вывод о том, что лучшим методом для моделирования многофункциональных центров обслуживания является сеть Петри. Конечные автоматы не позволяют отобразить вероятностные события, происходящие в многофункциональных центрах обслуживания. Конечные и вероятностные автоматы не позволят отобразить параллельную работу МФЦ, т.~к. придётся вводить большое количество дополнительных состояний, что сильно усложнит модель. Также они не учитывают время. И в отличии от систем массового обслуживания сети Петри концентрируются на локальных событиях и имею больше одного состояния на всю систему, что позволяет получать подробную информацию о каждом элементе в системе. Помимо этого, цветные сети Петри позволяют различать заявки по их типам, чтоб важно, так как разные заявки в МФЦ могут обслуживаться разное время и за них отвечают разные окна.


\section{Алгоритмы продвижения модельного времени}

Динамическая природа дискретно--событийных имитационных моделей требует, требует отслеживания текущего значения имитационного времени по мере функционирования имитационной модели. Также необходим механизм для продвижения имитационного времени от одного значения к другому. В имитационной модели переменная, переменная текущее значение модельного времени, называется часами модельного времени. Существует два основных подхода к продвижению модельного времени: продвижение времени от события к событию и продвижение времени с постоянным
шагом~\cite{time_alg}.

\subsection{Алгоритм продвижения времени от события к событию}

Характерное свойство систем обработки информации то, что состояния отдельных устройств изменяются в дискретные моменты времени, совпадающие с моментами поступления сообщений в систему, окончания
выполнения задания и т.п. При использовании продвижения времени от события к событию часы модельного времени в исходном состоянии устанавливаются в О и определяется время возникновения будущих событий. После этого часы модельного времени переходят на время возникновения ближайшего события, и в этот момент обновляются состояние системы с учётом произошедшего события, а также сведения о времени возникновения будущих событий. Затем часы модельного времени продвигаются ко времени возникновения следующего (нового) ближайшего события, обновляется состояние системы и определяется время будущих событий, и т. д. Процесс продвижения модельного времени от времени возникновения одного события ко времени возникновения другого продолжается до тех пор, пока не будет выполнено какое-либо условие останова, указанное заранее. Поскольку в дискретно--событийной имитационной модели все изменения происходят только во время возникновения событий, периоды бездействия системы просто пропускаются, и часы переводятся со времени возникновения одного события на время возникновения другого. Следует отметить, что длительность интервала продвижения модельного времени от одного события к другому может быть различной~\cite{time_alg}.

Для работы алгоритма в системе поддерживается список будущих событий, в котором для каждого активного блока, порождающего события заносится, заводится свой элемент. Каждый элемент хранит информацию об объекте и времени следующего события на объекте. Сам же алгоритм выглядит следующим образом:
\begin{itemize}[label=---]
	\item в списке находится ближайшее событие; 
	\item найденное событие реализуется;
	\item ячейка блока, выполнившего событие обновляется, генерируется интервал времени до нового события и прибавляется к текущему времени.
\end{itemize}

Достоинством этого алгоритма является: отсутствие сложности с подбором шага по времени, достаточно малого, чтоб ничего не пропустить, и достаточно большого, чтоб сократить количество итераций при моделировании.

Основным недостаток этого способа заключается в том, что при большом количестве событий приходится часто выполнять операцию линейного поиска по списку будущих событий, что особенно критично при наличии большого числа активных блоков. Для ускорения поиска можно поддерживать список в виде упорядоченной структуры данных.

\subsection{Алгоритм продвижения времени с постоянным шагом}

Другой подход к продвижению часов модельного времени в дискретно--событийной имитационной модели называется продвижением времени посредством постоянного шага. При таком подходе часы модельного времени двигаются точно на $\Delta t$ единиц времени/ После каждого обновления часов выполняется проверка с целью определить, произошли ли какие--либо события в течение предыдущего интервала времени $\Delta t$. Если на этот интервал запланированы одно или несколько событий, считается, что данные события происходят в конце интервала, после чего состояние системы соответствующим образом обновляется. В ситуациях, когда принято считать, что два или несколько событий происходят в одно и то же время, необходимо применение ряда
правил, позволяющих определять, в каком порядке обрабатывать события. Таким образом, продвижение времени посредством постоянного шага имеет два недостатка: возникновение ошибок, связанных с обработкой событий в конце интервала, в течение которого они происходят, а также необходимость решать, какое событие обрабатывать первым, если события, в действительности происходящие в разное время, рассматриваются как одновременные. Подобного рода проблемы можно частично решить, сделав интервалы $\Delta t$ менее продолжительными, но тогда
возрастает число проверок возникновения событий, что приводит к увеличению времени выполнения задачи. Продвижение времени с помощью постоянного шага не используют в дискретно--событийных имитационных моделях, когда интервалы времени между последовательными событиями могут значительно отличаться по своей продолжительности~\cite{time_alg2}. 

Получается основным недостатком этого алгоритма является сложность выбора шага, плохой выбор которого может привести к увеличению затрат машинного времени или получению неадекватных результатов при моделировании.

Основным достоинством является равномерная протяжка времени. 

\subsection{Алгоритм Дельфт}

Два приведённых метода являются универсальными алгоритмами протяжки модального времени. Причём для некоторых предметных областей один принцип может работать быстро и без потерь, а другой будет работать неэффективно. Выбор метода необходимо производить исходя из распределения событий по времени. В реальных системах
распределение событий, как правило, неоднородно. События, как бы группируются по времени. Образование таких групп связано с наступлением какого--то <<значимого>> события, которое начинает определённую последовательность действий с соответствующими событиями, имеющими высокую плотность на следующем временном интервале. Такой интервал называется пиковым. А распределение событий квазисинхронным. Примеров может являться приход посетителя в МФЦ, который запускает цепочку событий по его обслуживанию. Для сложных дискретных систем, в которых присутствуют квазиасинхронное распределение событий, был разработан алгоритм с название Дельфт. Особенностью данного метода является автоматическая адаптация к распределению событий. Метод реализуется таким образом, что на пиковых интервалах он приближается к методу с постоянным шагом, а вне
пиковых к событийному. В основе лежит использование иерархической структуры циркулярных списков. 

Пусть число ячеек  $N_1$ на самом низком уровне равно числу элементов циркулярного списка для пикового  интервала, т. е. максимальной длине пиковых интервалов, выраженной в квантах времени. На пиковых интервалах этот список будет действовать в соответствии с пошаговым  методом. Для числа ячеек  $N_2$ остальных иерархично расположенных списков, служащих для ускорения шага времени, выбираем равные значения. Таким образом, мы получим желаемую структуру данных, которая состоит из $m$ циркулярных списков индикаторов предсказываемых событий и сопряжённых с ними списков предсказываемых времён $T_j$ Одна ячейка первого циркулярного списка соответствует единице величины приращения времени, тогда как ячейки в  других списках соответствуют времени, которое описывается полным списком следующего низшего уровня. Полный временной период, описанный полным поэтапным прохождением до конца структуры списка, должен соответствовать среднему значению моделируемого времени между синхронными событиями~\cite{delft}.

Во время шага  моделируемого времени указатели,  принадлежащие к часовым  структурам, осуществляют полный оборот и таким образом показывают соответствующие интервалы по модулям $N_1$ и $N_2$. Ячейки списков от уровня 2 до $m$ содержат числа событий, предсказываемых в соответствующем интервале  времени, тогда как ячейки первого циркулярного списка содержат указатели на начало принадлежащих к ним списков событий, если такие имеются~\cite{delft}.

При записи события в циркулярных списках от уровня 2 до $m$, увеличивается счётчик событий в соответствующей ячейке и событие добавляется в соответствующий список, указательна на который хранится в ячейке 1 уровня. При удалении события соответветственно декрементируется счётчик в списках высокого уровня, и событие удаляется из списка событий ячейки 1 уровня~\cite{delft}. 

Шаг моделируемого времени вычисляется предлагаемым алгоритмом с учётом двух ситуаций: в пиковых интервалах, где плотность событий велика, шаг времени определяется элементарным отрезком времени в  соответствии с первым циркулярным списком; в интервалах с малой плотностью событий система стремится как можно быстрее «шагнуть» до следующего предсказанного события~\cite{delft}.

Вначале длина шага соответствует ячейкам самого верхнего циркулярного списка, пустые ячейки «перепрыгиваются». Когда обнаруживается непустая ячейка, то осуществляется переход на следующий уровень вниз до тех пор, пока на самом нижнем уровне не обнаружится предсказанный указатель на список событий~\cite{delft}.

Данный алгоритм, адаптируется под распределение событий и тем самым объединяет в себе плюсы методов с постоянным шагом и событийного.

\subsection*{Вывод}

Были рассмотри три различных алгоритма протяжки модельного времени, а также их основные достоинства и недостатки. Можно сделать вывод о том, что лучшим из рассмотренных методов является комбинированный Дельфт, так как он подстраивается под распределение событий. Это позволяет ему при большом количестве событий приближаться к пошаговому методу, который хорошо работает в таких случаях, а при малом количестве событий шагать через крупные промежутки времени, как событийный метод.


\section{Постановка задачи}

На основе анализа и сравнения методов моделирования многофункциональных центров обслуживания можно сформулировать следующую цель данной работы: реализовать метод моделирования многофункциональных центров обслуживания на основе сетей Петри и комбинированнного метода продвижения модельного времени. Формально постановка задачи может быть описана с помощью IDEF0--диаграмм нулевого и первого уровня, которые приведены на рисунках \ref{img:idef0_0}~и~\ref{img:idef0_1}.

\imgScale{1}{idef0_0}{Диаграмма постановки задачи нулевого уровня}
\FloatBarrier

\imgScale{0.6}{idef0_1}{Диаграмма постановки задачи первого уровня}
\FloatBarrier

\section*{Вывод}

В данном разделе был проведён анализ предметной области моделирования многофункциональных центров обслуживания. Также были описаны основные формализмы используемые для моделирования многофункциональных центров обслуживания и проведён их сравнительный анализ, в результате которого был сделан вывод, что лучше всех подходят сети Петри. Были рассмотрены основные методы протяжки модельного времени и был выбран комбинированный, как сочетающий основные достоинства базовых алгоритмов. Была описана формальная постановка задачи в виде IDEF0--диаграммы
